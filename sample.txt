import org.apache.poi.hssf.usermodel.HSSFWorkbook;
import org.apache.poi.ss.usermodel.*;
import org.apache.poi.xssf.usermodel.XSSFPictureData;
import org.apache.poi.xssf.usermodel.XSSFWorkbook;
import org.apache.pdfbox.pdmodel.*;
import org.apache.pdfbox.pdmodel.font.PDType1Font;
import org.apache.pdfbox.pdmodel.graphics.image.PDImageXObject;

import javax.imageio.ImageIO;
import java.awt.image.BufferedImage;
import java.io.*;
import java.util.List;

public class ExcelToPDF {
    public static void main(String[] args) throws Exception {
        FileInputStream fis = new FileInputStream("input.xls"); // Change to "input.xlsx" for XLSX
        Workbook workbook = WorkbookFactory.create(fis);
        PDDocument pdf = new PDDocument();

        for (Sheet sheet : workbook) {
            PDPage page = new PDPage(PDRectangle.A4);
            pdf.addPage(page);
            PDPageContentStream contentStream = new PDPageContentStream(pdf, page);
            
            contentStream.setFont(PDType1Font.HELVETICA, 10);
            contentStream.setLeading(14);
            contentStream.beginText();
            contentStream.newLineAtOffset(50, 750);

            for (Row row : sheet) {
                for (Cell cell : row) {
                    String value = cell.toString();  // Extract only displayed values
                    contentStream.showText(value + " | "); // Simulating columns
                }
                contentStream.newLine();
            }

            contentStream.endText();
            contentStream.close();
        }

        // Extract images (ONLY FOR XLSX)
        if (workbook instanceof XSSFWorkbook) {
            List<XSSFPictureData> pictures = ((XSSFWorkbook) workbook).getAllPictures();
            for (XSSFPictureData picture : pictures) {
                byte[] imageBytes = picture.getData();
                PDImageXObject pdImage = PDImageXObject.createFromByteArray(pdf, imageBytes, "image");

                PDPage imgPage = new PDPage(PDRectangle.A4);
                pdf.addPage(imgPage);
                PDPageContentStream imgStream = new PDPageContentStream(pdf, imgPage);
                imgStream.drawImage(pdImage, 50, 500, 400, 300);
                imgStream.close();
            }
        } else {
            System.out.println("⚠️ Image extraction is not supported for XLS files.");
        }

        pdf.save("output.pdf");
        pdf.close();
        workbook.close();
        fis.close();

        System.out.println("✅ Excel (XLS/XLSX) to PDF conversion completed!");
    }
}
